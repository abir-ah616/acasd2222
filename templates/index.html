<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MR OPPY - Emote Bot Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --purple-primary: #8e2de2;
            --purple-secondary: #4a00e0;
            --purple-light: #a099d8;
            --purple-dark: #18116a;
            --pink: #cf30aa;
            --pink-dark: #6e1b60;
            --bg-black: #000000;
            --bg-card: #0a0a0a;
            --bg-input: #010201;
            --border-subtle: #1c191c;
            --text-primary: #ffffff;
            --text-muted: #c0b9c0;
            --text-dark: #837484;
        }

        html, body { height: 100%; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-black);
            color: var(--text-primary);
            padding: 20px;
            font-size: 16px;
            position: relative;
            overflow-x: hidden;
        }

        /* Grid Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(to right, #0f0f10 1px, transparent 1px),
                linear-gradient(to bottom, #0f0f10 1px, transparent 1px);
            background-size: 1rem 1rem;
            background-position: center center;
            z-index: 0;
            opacity: 0.3;
            filter: blur(0.5px);
            pointer-events: none;
        }

        /* Purple block overlay */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(142, 45, 226, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(207, 48, 170, 0.03) 0%, transparent 50%);
            z-index: 0;
            pointer-events: none;
        }

        .container {
            max-width: 98%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
            z-index: 1;
        }

        /* Clean Minimalist Header */
        header {
            text-align: center;
            padding: 40px 0 20px 0;
            margin-bottom: 30px;
            flex-shrink: 0;
            position: relative;
        }

        h1 {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--purple-primary), var(--pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin: 0;
        }

        /* Toast Notification System */
        #toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 24px;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            border: 1px solid;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6);
            animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
            min-width: 320px;
        }

        .toast::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: currentColor;
        }

        .toast-icon {
            font-size: 24px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }

        .toast-content {
            flex-grow: 1;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            line-height: 1.5;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 20px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: currentColor;
            animation: progressShrink 4s linear forwards;
        }

        .toast-success {
            border-color: rgba(142, 45, 226, 0.4);
            color: var(--purple-primary);
        }

        .toast-danger {
            border-color: rgba(207, 48, 170, 0.4);
            color: var(--pink);
        }

        .toast-warning {
            border-color: rgba(245, 158, 11, 0.4);
            color: #f59e0b;
        }

        .toast-info {
            border-color: rgba(96, 165, 250, 0.4);
            color: #60a5fa;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        @keyframes progressShrink {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }

        .toast.fade-out {
            animation: fadeOutRight 0.4s ease forwards;
        }

        @keyframes fadeOutRight {
            to {
                opacity: 0;
                transform: translateX(100px) scale(0.8);
            }
        }

        /* Layout Grid */
        .grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
            height: 100%;
            min-height: 0;
        }

        @media (max-width: 900px) {
            .grid { grid-template-columns: 1fr; }
        }

        .main-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
            min-height: 0;
            height: 100%;
        }

        .target-management-card {
            display: flex;
            flex-direction: column;
            max-height: 500px;
        }

        .target-management-card .card-title {
            flex-shrink: 0;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Card with Glowing Border */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: conic-gradient(
                from 0deg,
                var(--purple-dark),
                var(--purple-primary) 25%,
                var(--pink) 50%,
                var(--purple-primary) 75%,
                var(--purple-dark)
            );
            border-radius: 16px;
            z-index: -1;
            opacity: 0.6;
            filter: blur(8px);
        }

        .card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--bg-card);
            border-radius: 16px;
            z-index: -1;
        }

        .card.scrollable {
            flex-grow: 1;
            min-height: 0;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-shrink: 0;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(142, 45, 226, 0.2);
        }

        .card-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--purple-light);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Custom Input with Glowing Border */
        .input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .glow-input-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .glow, .border-layer, .darkBorderBg, .white-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 12px;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }

        .glow {
            filter: blur(20px);
            opacity: 0.3;
        }

        .glow::before, .border-layer::before, .darkBorderBg::before, .white-layer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: max(400px, 200%);
            height: max(400px, 200%);
            background-repeat: no-repeat;
            background-position: 0 0;
            transition: transform 2s ease;
        }

        .white-layer {
            filter: blur(2px);
        }

        .white-layer::before {
            transform: translate(-50%, -50%) rotate(83deg);
            background-image: conic-gradient(
                rgba(0, 0, 0, 0) 0%,
                var(--purple-light),
                rgba(0, 0, 0, 0) 8%,
                rgba(0, 0, 0, 0) 50%,
                var(--pink),
                rgba(0, 0, 0, 0) 58%
            );
            filter: brightness(1.4);
        }

        .border-layer {
            filter: blur(0.5px);
        }

        .border-layer::before {
            transform: translate(-50%, -50%) rotate(70deg);
            background-image: conic-gradient(
                var(--border-subtle),
                var(--purple-secondary) 5%,
                var(--border-subtle) 14%,
                var(--border-subtle) 50%,
                var(--pink) 60%,
                var(--border-subtle) 64%
            );
            filter: brightness(1.3);
        }

        .darkBorderBg::before {
            transform: translate(-50%, -50%) rotate(82deg);
            background-image: conic-gradient(
                rgba(0, 0, 0, 0),
                var(--purple-dark),
                rgba(0, 0, 0, 0) 10%,
                rgba(0, 0, 0, 0) 50%,
                var(--pink-dark),
                rgba(0, 0, 0, 0) 60%
            );
        }

        .glow::before {
            transform: translate(-50%, -50%) rotate(60deg);
            width: max(600px, 250%);
            height: max(600px, 250%);
            background-image: conic-gradient(
                #000,
                var(--purple-secondary) 5%,
                #000 38%,
                #000 50%,
                var(--pink) 60%,
                #000 87%
            );
        }

        .glow-input-container:hover .darkBorderBg::before {
            transform: translate(-50%, -50%) rotate(-98deg);
        }

        .glow-input-container:hover .glow::before {
            transform: translate(-50%, -50%) rotate(-120deg);
        }

        .glow-input-container:hover .white-layer::before {
            transform: translate(-50%, -50%) rotate(-97deg);
        }

        .glow-input-container:hover .border-layer::before {
            transform: translate(-50%, -50%) rotate(-110deg);
        }

        .glow-input-container:focus-within .darkBorderBg::before {
            transform: translate(-50%, -50%) rotate(442deg);
            transition: transform 4s ease;
        }

        .glow-input-container:focus-within .glow::before {
            transform: translate(-50%, -50%) rotate(420deg);
            transition: transform 4s ease;
        }

        .glow-input-container:focus-within .white-layer::before {
            transform: translate(-50%, -50%) rotate(443deg);
            transition: transform 4s ease;
        }

        .glow-input-container:focus-within .border-layer::before {
            transform: translate(-50%, -50%) rotate(430deg);
            transition: transform 4s ease;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            background-color: var(--bg-input);
            border: none;
            padding: 16px 20px;
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            position: relative;
            z-index: 1;
            -webkit-appearance: none;
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input::placeholder {
            color: var(--text-muted);
        }

        input:focus {
            outline: none;
        }

        /* Purple Gradient Buttons */
        button {
            position: relative;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.05em;
            border-radius: 12px;
            cursor: pointer;
            border: none;
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-secondary));
            color: var(--text-primary);
            overflow: hidden;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        button span {
            position: relative;
            z-index: 10;
            transition: color 0.4s;
            display: inline-flex;
            align-items: center;
            padding: 12px 24px;
        }

        button::before,
        button::after {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        button::before {
            content: '';
            background: #000;
            width: 120%;
            left: -10%;
            transform: skew(30deg);
            transition: transform 0.4s cubic-bezier(0.3, 1, 0.8, 1);
        }

        button:hover::before {
            transform: translate3d(100%, 0, 0);
        }

        button:active {
            transform: scale(0.98);
        }

        .btn-sm {
            font-size: 12px;
        }

        .btn-sm span {
            padding: 8px 16px;
        }

        .btn-pink {
            background: linear-gradient(135deg, var(--pink), var(--pink-dark));
        }

        .btn-success {
            background: linear-gradient(135deg, var(--purple-primary), var(--purple-light));
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--pink), #8b1a5c);
        }

        /* Target Rows */
        .uid-row {
            display: grid;
            grid-template-columns: 30px 1fr auto auto;
            gap: 12px;
            align-items: center;
            padding: 12px;
            background: rgba(20, 20, 20, 0.5);
            border: 1px solid rgba(142, 45, 226, 0.2);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .uid-row:hover {
            background: rgba(30, 30, 30, 0.6);
            border-color: rgba(142, 45, 226, 0.5);
            transform: translateX(4px);
        }

        .uid-row input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--purple-primary);
            cursor: pointer;
        }

        .uid-row input[type="number"] {
            margin: 0;
            padding: 10px 14px;
            font-size: 14px;
        }

        .uid-row .glow-input-container {
            width: 100%;
        }

        .emote-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid rgba(142, 45, 226, 0.3);
            border-radius: 10px;
            font-size: 12px;
            min-width: 140px;
        }

        .emote-badge img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
        }

        .emote-badge.empty {
            color: var(--text-muted);
            font-style: italic;
        }

        .uid-actions {
            display: flex;
            gap: 6px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background: rgba(142, 45, 226, 0.15);
            border: 1px solid rgba(142, 45, 226, 0.3);
            color: var(--purple-light);
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-icon:hover {
            background: rgba(142, 45, 226, 0.3);
            transform: scale(1.1);
        }

        .btn-icon span {
            padding: 0;
        }

        #uid-container {
            padding-right: 8px;
            overflow-y: auto;
            max-height: 340px;
            flex-grow: 1;
            min-height: 0;
        }

        #uid-container::-webkit-scrollbar {
            width: 8px;
        }

        #uid-container::-webkit-scrollbar-track {
            background: rgba(20, 20, 20, 0.5);
            border-radius: 4px;
        }

        #uid-container::-webkit-scrollbar-thumb {
            background: var(--purple-primary);
            border-radius: 4px;
        }

        /* Emote Grid */
        .emote-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 14px;
            overflow-y: auto;
            padding: 14px;
            background: rgba(5, 5, 5, 0.5);
            border-radius: 16px;
            border: 1px solid rgba(142, 45, 226, 0.15);
            flex-grow: 1;
            min-height: 0;
            height: 100%;
        }

        .emote-grid::-webkit-scrollbar {
            width: 8px;
        }

        .emote-grid::-webkit-scrollbar-track {
            background: rgba(20, 20, 20, 0.5);
            border-radius: 4px;
        }

        .emote-grid::-webkit-scrollbar-thumb {
            background: var(--purple-primary);
            border-radius: 4px;
        }

        .emote-item {
            background: rgba(15, 15, 15, 0.8);
            border: 2px solid transparent;
            border-radius: 14px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .emote-item:hover {
            transform: translateY(-4px);
            border-color: var(--purple-light);
            background: rgba(20, 20, 20, 0.9);
            box-shadow: 0 8px 24px rgba(142, 45, 226, 0.3);
        }

        .emote-item.selected {
            border-color: var(--purple-primary);
            background: rgba(142, 45, 226, 0.15);
            box-shadow: 0 8px 32px rgba(142, 45, 226, 0.5);
        }

        .emote-item.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: var(--purple-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .emote-item img {
            width: 64px;
            height: 64px;
            object-fit: contain;
            margin-bottom: 8px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        .emote-item .emote-details {
            font-size: 11px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .emote-item .emote-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .emote-item .emote-id {
            display: none;
        }

        .card-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Stats */
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid rgba(142, 45, 226, 0.15);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .stat-row:hover {
            background: rgba(142, 45, 226, 0.05);
            padding-left: 12px;
            padding-right: 12px;
            border-radius: 8px;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            color: var(--purple-primary);
            font-weight: 700;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="toast-container"></div>

    <div class="container">
        <header>
            <h1>MR OPPY EMOTE BOT</h1>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <script>
                    window.flashMessages = {{ messages|tojson }};
                </script>
            {% endif %}
        {% endwith %}

        <form id="main-form" action="/action" method="post" style="flex-grow: 1; min-height: 0;">
            <input type="hidden" name="action" id="form_action">
            <input type="hidden" name="payload" id="form_payload">
            <div class="grid">
                <div class="main-panel">
                    <div class="card target-management-card">
                        <div class="card-title">Target Management</div>
                        <div id="uid-container"></div>
                        <button type="button" id="add-uid-btn" class="btn-success btn-sm" style="margin-top: 10px; flex-shrink: 0;">
                            <span>+ Add Target</span>
                        </button>
                    </div>

                    <div class="card scrollable">
                        <div class="card-header">
                            <div class="card-title">Emote Palette</div>
                            <div class="card-actions">
                                <button type="button" id="send-selected" class="btn-pink btn-sm">
                                    <span>Send to Checked</span>
                                </button>
                                <button type="button" id="send-all" class="btn-sm">
                                    <span>Send All Assigned</span>
                                </button>
                            </div>
                        </div>
                        <div class="emote-grid" id="emote-grid">
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000075.png') }}" alt="MP40 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">MP40 MAX</p>
                                    <p class="emote-id">ID: 909000075</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000063.png') }}" alt="AK47 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">AK47 MAX</p>
                                    <p class="emote-id">ID: 909000063</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909035007.png') }}" alt="M1887 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">M1887 MAX</p>
                                    <p class="emote-id">ID: 909035007</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000068.png') }}" alt="SCAR MAX">
                                <div class="emote-details">
                                    <p class="emote-name">SCAR MAX</p>
                                    <p class="emote-id">ID: 909000068</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000085.png') }}" alt="XM8 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">XM8 MAX</p>
                                    <p class="emote-id">ID: 909000085</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909038012.png') }}" alt="G18 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">G18 MAX</p>
                                    <p class="emote-id">ID: 909038012</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909035012.png') }}" alt="AN94 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">AN94 MAX</p>
                                    <p class="emote-id">ID: 909035012</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909033002.png') }}" alt="MP5 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">MP5 MAX</p>
                                    <p class="emote-id">ID: 909033002</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909051003.png') }}" alt="M60 MAX">
                                <div class="emote-details">
                                    <p class="emote-name">M60 MAX</p>
                                    <p class="emote-id">ID: 909051003</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909037011.png') }}" alt="FIST MAX">
                                <div class="emote-details">
                                    <p class="emote-name">FIST MAX</p>
                                    <p class="emote-id">ID: 909037011</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000081.png') }}" alt="M1014 GMAX">
                                <div class="emote-details">
                                    <p class="emote-name">M1014 GMAX</p>
                                    <p class="emote-id">ID: 909000081</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909039011.png') }}" alt="M1014 RMAX">
                                <div class="emote-details">
                                    <p class="emote-name">M1014 RMAX</p>
                                    <p class="emote-id">ID: 909039011</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000090.png') }}" alt="Famas Max">
                                <div class="emote-details">
                                    <p class="emote-name">Famas Max</p>
                                    <p class="emote-id">ID: 909000090</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909049010.png') }}" alt="P90 Max">
                                <div class="emote-details">
                                    <p class="emote-name">P90 Max</p>
                                    <p class="emote-id">ID: 909049010</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909038010.png') }}" alt="Thompson Max">
                                <div class="emote-details">
                                    <p class="emote-name">Thompson Max</p>
                                    <p class="emote-id">ID: 909038010</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909033001.png') }}" alt="M4A1 Max">
                                <div class="emote-details">
                                    <p class="emote-name">M4A1 Max</p>
                                    <p class="emote-id">ID: 909033001</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000098.png') }}" alt="UMP Max">
                                <div class="emote-details">
                                    <p class="emote-name">UMP Max</p>
                                    <p class="emote-id">ID: 909000098</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909040010.png') }}" alt="New M40 Max">
                                <div class="emote-details">
                                    <p class="emote-name">New M40 Max</p>
                                    <p class="emote-id">ID: 909040010</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909045001.png') }}" alt="Parafal Max">
                                <div class="emote-details">
                                    <p class="emote-name">Parafal Max</p>
                                    <p class="emote-id">ID: 909045001</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909042008.png') }}" alt="WD Picker Max">
                                <div class="emote-details">
                                    <p class="emote-name">WD Picker Max</p>
                                    <p class="emote-id">ID: 909042008</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909049012.png') }}" alt="Open Fire">
                                <div class="emote-details">
                                    <p class="emote-name">Open Fire</p>
                                    <p class="emote-id">ID: 909049012</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000002.png') }}" alt="LOL">
                                <div class="emote-details">
                                    <p class="emote-name">LOL</p>
                                    <p class="emote-id">ID: 909000002</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909042007.png') }}" alt="100 Gloo Sculpture">
                                <div class="emote-details">
                                    <p class="emote-name">"100" Gloo Sculpture</p>
                                    <p class="emote-id">ID: 909042007</p>
                                </div>
                            </div>
                            <div class="emote-item">
                                <img src="{{ url_for('static', filename='images/909000012.png') }}" alt="Push Up">
                                <div class="emote-details">
                                    <p class="emote-name">Push Up</p>
                                    <p class="emote-id">ID: 909000012</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar">
                    <div class="card">
                        <div class="card-title">Settings</div>
                        <div class="input-wrapper">
                            <label>Main Account UID</label>
                            <div class="glow-input-container">
                                <div class="glow"></div>
                                <div class="darkBorderBg"></div>
                                <div class="white-layer"></div>
                                <div class="border-layer"></div>
                                <input type="number" id="main_player_uid" placeholder="Enter your UID">
                            </div>
                        </div>
                        <div class="input-wrapper">
                            <label>Team Code</label>
                            <div class="glow-input-container">
                                <div class="glow"></div>
                                <div class="darkBorderBg"></div>
                                <div class="white-layer"></div>
                                <div class="border-layer"></div>
                                <input type="text" id="team_code" placeholder="Enter squad code">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">Quick Actions</div>
                        <div class="quick-actions">
                            <button type="button" id="join-squad">
                                <span>Join Squad</span>
                            </button>
                            <button type="button" id="quick-invite" class="btn-success">
                                <span>Create & Invite</span>
                            </button>
                            <button type="button" id="leave-squad" class="btn-danger">
                                <span>Leave Squad</span>
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">Status</div>
                        <div class="stat-row">
                            <span class="stat-label">Targets</span>
                            <span class="stat-value" id="stat-targets">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Assigned</span>
                            <span class="stat-value" id="stat-assigned">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Selected</span>
                            <span class="stat-value" id="stat-selected">None</span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const state = { selectedEmote: null };
            const els = {
                mainUid: document.getElementById('main_player_uid'),
                teamCode: document.getElementById('team_code'),
                uidContainer: document.getElementById('uid-container'),
                emoteGrid: document.getElementById('emote-grid'),
                form: document.getElementById('main-form'),
                formAction: document.getElementById('form_action'),
                formPayload: document.getElementById('form_payload')
            };

            function updateStats() {
                const rows = els.uidContainer.querySelectorAll('.uid-row');
                const assigned = Array.from(rows).filter(r => r.dataset.emoteId).length;
                document.getElementById('stat-targets').textContent = rows.length;
                document.getElementById('stat-assigned').textContent = assigned;
                document.getElementById('stat-selected').textContent = state.selectedEmote ? state.selectedEmote.name : 'None';
            }

            function updateEmoteBadge(row, emoteData) {
                const badge = row.querySelector('.emote-badge');
                if (emoteData && emoteData.id) {
                    row.dataset.emoteId = emoteData.id;
                    row.dataset.emoteName = emoteData.name;
                    row.dataset.emoteImg = emoteData.img;
                    badge.classList.remove('empty');
                    badge.querySelector('img').src = emoteData.img;
                    badge.querySelector('img').style.display = 'block';
                    badge.querySelector('span').textContent = emoteData.name;
                } else {
                    delete row.dataset.emoteId;
                    delete row.dataset.emoteName;
                    delete row.dataset.emoteImg;
                    badge.classList.add('empty');
                    badge.querySelector('img').style.display = 'none';
                    badge.querySelector('span').textContent = 'None';
                }
            }

            function createUidRow(targetData = {}, isMain = false) {
                const div = document.createElement('div');
                div.className = 'uid-row';
                div.innerHTML = `
                    <input type="checkbox" checked>
                    <div class="glow-input-container">
                        <div class="glow"></div>
                        <div class="darkBorderBg"></div>
                        <div class="white-layer"></div>
                        <div class="border-layer"></div>
                        <input type="number" placeholder="${isMain ? 'Main UID' : 'Target UID'}" value="${targetData.uid || ''}" ${isMain ? 'readonly' : ''}>
                    </div>
                    <div class="emote-badge empty"><img src="" style="display:none"><span>None</span></div>
                    <div class="uid-actions">
                        <button type="button" class="btn-icon" title="Assign" data-action="assign"><span>ðŸ“Œ</span></button>
                        <button type="button" class="btn-icon" title="Clear" data-action="clear"><span>âœ•</span></button>
                        <button type="button" class="btn-icon btn-success" title="Send" data-action="send"><span>âž¤</span></button>
                        ${!isMain ? '<button type="button" class="btn-icon btn-danger" title="Remove" data-action="remove"><span>ðŸ—‘</span></button>' : ''}
                    </div>`;
                els.uidContainer.appendChild(div);
                if (targetData.emoteId) updateEmoteBadge(div, { id: targetData.emoteId, name: targetData.emoteName, img: targetData.emoteImg });
                updateStats();
                return div;
            }

            function saveData() {
                localStorage.setItem('spideerio_main_uid', els.mainUid.value);
                localStorage.setItem('spideerio_team_code', els.teamCode.value);
                const targets = [];
                els.uidContainer.querySelectorAll('.uid-row').forEach(row => {
                    const uidInput = row.querySelector('input[type="number"]');
                    const target = { uid: uidInput.value };
                    if (row.dataset.emoteId) {
                        target.emoteId = row.dataset.emoteId;
                        target.emoteName = row.dataset.emoteName;
                        target.emoteImg = row.dataset.emoteImg;
                    }
                    if (uidInput.readOnly) target.isMain = true;
                    targets.push(target);
                });
                localStorage.setItem('spideerio_targets', JSON.stringify(targets));
            }

            function loadData() {
                els.mainUid.value = localStorage.getItem('spideerio_main_uid') || '';
                els.teamCode.value = localStorage.getItem('spideerio_team_code') || '';
                const targets = JSON.parse(localStorage.getItem('spideerio_targets') || '[]');
                els.uidContainer.innerHTML = '';
                if (targets.length === 0) createUidRow({ uid: els.mainUid.value }, true);
                else targets.forEach(t => createUidRow(t, t.isMain));
                updateStats();
            }

            function submitForm(action, payload) {
                els.formAction.value = action;
                els.formPayload.value = JSON.stringify(payload);
                els.form.submit();
            }

            els.mainUid.addEventListener('input', () => {
                const mainRowInput = els.uidContainer.querySelector('.uid-row input[readonly]');
                if (mainRowInput) mainRowInput.value = els.mainUid.value;
                saveData();
            });

            els.teamCode.addEventListener('input', saveData);

            document.getElementById('add-uid-btn').addEventListener('click', () => {
                if (els.uidContainer.children.length >= 5) {
                    alert('Maximum 5 targets');
                    return;
                }
                createUidRow({}, false);
            });

            els.emoteGrid.addEventListener('click', e => {
                const card = e.target.closest('.emote-item');
                if (!card) return;
                const name = card.querySelector('.emote-name').textContent;
                const idText = card.querySelector('.emote-id').textContent;
                const id = idText.replace('ID: ', '').trim();
                const img = card.querySelector('img').src;
                state.selectedEmote = { id: id, name: name, img: img };
                els.emoteGrid.querySelectorAll('.emote-item').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                updateStats();
            });

            els.uidContainer.addEventListener('input', e => {
                if (e.target.matches('input[type="number"]')) saveData();
            });

            els.uidContainer.addEventListener('click', e => {
                const btn = e.target.closest('button[data-action]');
                if (!btn) return;
                const row = btn.closest('.uid-row');
                const action = btn.dataset.action;
                if (action === 'assign') {
                    if (!state.selectedEmote) {
                        alert('Select an emote from the palette first');
                        return;
                    }
                    updateEmoteBadge(row, state.selectedEmote);
                } else if (action === 'clear') {
                    updateEmoteBadge(row, null);
                } else if (action === 'send') {
                    const uid = row.querySelector('input[type="number"]').value;
                    const emoteId = row.dataset.emoteId;
                    if (!uid || !emoteId) {
                        alert('A UID must be entered and an emote must be assigned.');
                        return;
                    }
                    submitForm('emote_batch', [{ player_id: parseInt(uid), emote_id: parseInt(emoteId) }]);
                } else if (action === 'remove') {
                    row.remove();
                }
                saveData();
                updateStats();
            });

            document.getElementById('send-selected').addEventListener('click', () => {
                if (!state.selectedEmote) {
                    alert('Select an emote from the palette first.');
                    return;
                }
                const checked = Array.from(els.uidContainer.querySelectorAll('input[type="checkbox"]:checked'))
                    .map(cb => cb.closest('.uid-row').querySelector('input[type="number"]').value)
                    .filter(Boolean);
                if (checked.length === 0) {
                    alert('Check at least one target with a valid UID.');
                    return;
                }
                submitForm('emote', { emote_id: parseInt(state.selectedEmote.id), player_ids: checked.map(uid => parseInt(uid)) });
            });

            document.getElementById('send-all').addEventListener('click', () => {
                const payload = [];
                els.uidContainer.querySelectorAll('.uid-row').forEach(row => {
                    if (row.dataset.emoteId) {
                        const uid = row.querySelector('input[type="number"]').value;
                        if (uid) payload.push({ player_id: parseInt(uid), emote_id: parseInt(row.dataset.emoteId) });
                    }
                });
                if (payload.length === 0) {
                    alert('No assigned emotes to send.');
                    return;
                }
                submitForm('emote_batch', payload);
            });

            document.getElementById('join-squad').addEventListener('click', () => {
                if (!els.teamCode.value) {
                    alert('Enter a team code first.');
                    return;
                }
                submitForm('join_squad', { team_code: els.teamCode.value });
            });

            document.getElementById('quick-invite').addEventListener('click', () => {
                if (!els.mainUid.value) {
                    alert('Enter your main account UID first.');
                    return;
                }
                submitForm('quick_invite', { player_id: parseInt(els.mainUid.value) });
            });

            document.getElementById('leave-squad').addEventListener('click', () => {
                if (confirm('Are you sure you want the bot to leave its current squad?'))
                    submitForm('leave_squad', {});
            });

            loadData();

            // Toast Notification System
            function showToast(message, type = 'success', duration = 4000) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;

                const icons = {
                    success: 'âœ“',
                    danger: 'âœ•',
                    warning: 'âš ',
                    info: 'â„¹'
                };

                toast.innerHTML = `
                    <div class="toast-icon">${icons[type] || icons.success}</div>
                    <div class="toast-content">${message}</div>
                    <button class="toast-close">Ã—</button>
                    <div class="toast-progress"></div>
                `;

                container.appendChild(toast);

                const closeBtn = toast.querySelector('.toast-close');
                closeBtn.addEventListener('click', () => {
                    toast.classList.add('fade-out');
                    setTimeout(() => toast.remove(), 400);
                });

                setTimeout(() => {
                    toast.classList.add('fade-out');
                    setTimeout(() => toast.remove(), 400);
                }, duration);
            }

            // Show flash messages if any
            if (window.flashMessages) {
                window.flashMessages.forEach(([category, message], index) => {
                    setTimeout(() => {
                        showToast(message, category);
                    }, index * 300);
                });
            }

            // Override alerts to use toast
            const originalAlert = window.alert;
            window.alert = function(message) {
                showToast(message, 'warning', 5000);
            };
        });
    </script>
</body>
</html>
